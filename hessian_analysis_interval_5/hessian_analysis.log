2025-05-06 03:06:41 INFO     实验参数: {'batch_size': 128, 'hessian_batch_size': 128, 'mini_hessian_batch_size': 128, 'epochs': 2, 'lr': 0.001, 'r': 10, 'save_interval': 10, 'resume': './checkpoints/resnet20_cifar10.pkl', 'cifar10c_path': '../data/CIFAR-10-C', 'noise_type': 'gaussian_noise', 'corruption_level': 5, 'seed': 1, 'cuda': True, 'save_dir': './hessian_analysis_test'}
2025-05-06 03:06:41 INFO     使用设备: cuda
2025-05-06 03:06:41 INFO     加载CIFAR10-C数据集: gaussian_noise, 级别: 5
2025-05-06 03:06:41 INFO     CIFAR10-C数据集已存在于嵌套目录 ../data/CIFAR-10-C/CIFAR-10-C，将复制到目标目录
2025-05-06 03:06:41 INFO     复制文件 frost.npy 到目标目录
2025-05-06 03:06:41 INFO     复制文件 impulse_noise.npy 到目标目录
2025-05-06 03:06:41 INFO     复制文件 speckle_noise.npy 到目标目录
2025-05-06 03:06:41 INFO     复制文件 pixelate.npy 到目标目录
2025-05-06 03:06:42 INFO     复制文件 spatter.npy 到目标目录
2025-05-06 03:06:42 INFO     复制文件 zoom_blur.npy 到目标目录
2025-05-06 03:06:42 INFO     复制文件 shot_noise.npy 到目标目录
2025-05-06 03:06:42 INFO     复制文件 labels.npy 到目标目录
2025-05-06 03:06:42 INFO     复制文件 brightness.npy 到目标目录
2025-05-06 03:06:42 INFO     复制文件 gaussian_noise.npy 到目标目录
2025-05-06 03:06:42 INFO     复制文件 fog.npy 到目标目录
2025-05-06 03:06:43 INFO     复制文件 jpeg_compression.npy 到目标目录
2025-05-06 03:06:43 INFO     复制文件 gaussian_blur.npy 到目标目录
2025-05-06 03:06:43 INFO     复制文件 snow.npy 到目标目录
2025-05-06 03:06:43 INFO     复制文件 glass_blur.npy 到目标目录
2025-05-06 03:06:43 INFO     复制文件 defocus_blur.npy 到目标目录
2025-05-06 03:06:43 INFO     复制文件 elastic_transform.npy 到目标目录
2025-05-06 03:06:43 INFO     复制文件 contrast.npy 到目标目录
2025-05-06 03:06:43 INFO     复制文件 motion_blur.npy 到目标目录
2025-05-06 03:06:44 INFO     复制文件 saturate.npy 到目标目录
2025-05-06 03:06:44 INFO     文件复制完成
2025-05-06 03:06:45 INFO     数据集大小: 10000
2025-05-06 03:07:42 INFO     加载预训练模型: ./checkpoints/resnet20_cifar10.pkl
2025-05-06 03:07:42 INFO     在微调前计算Hessian特征值和特征向量
2025-05-06 03:08:07 INFO     微调前的Top-10特征值: [4274.29638671875, 1776.5250244140625, 1266.2069091796875, 1039.64794921875, 906.1414794921875, 921.9917602539062, 728.5900268554688, 702.4734497070312, -566.5518188476562, 560.5966796875]
2025-05-06 03:08:07 INFO     微调前的Trace: 18065.580400390623
2025-05-06 03:13:15 INFO     实验参数: {'batch_size': 128, 'hessian_batch_size': 128, 'mini_hessian_batch_size': 128, 'epochs': 1, 'lr': 0.001, 'r': 10, 'save_interval': 5, 'resume': './checkpoints/resnet20_cifar10.pkl', 'cifar10c_path': '../data/CIFAR-10-C', 'noise_type': 'gaussian_noise', 'corruption_level': 5, 'seed': 1, 'cuda': True, 'save_dir': './hessian_analysis_test'}
2025-05-06 03:13:15 INFO     使用设备: cuda
2025-05-06 03:13:15 INFO     加载CIFAR10-C数据集: gaussian_noise, 级别: 5
2025-05-06 03:13:16 INFO     数据集大小: 10000
2025-05-06 03:13:16 INFO     加载预训练模型: ./checkpoints/resnet20_cifar10.pkl
2025-05-06 03:13:17 INFO     在微调前计算Hessian特征值和特征向量
2025-05-06 03:13:42 INFO     微调前的Top-10特征值: [4274.2978515625, 1776.525146484375, 1266.20703125, 1039.64794921875, 906.1414794921875, 921.9916381835938, 728.590087890625, 702.473388671875, -566.5518188476562, 560.5966186523438]
2025-05-06 03:13:42 INFO     微调前的Trace: 18065.580341796875
2025-05-06 03:13:42 INFO     开始微调模型并收集Hessian信息
2025-05-06 03:13:42 INFO     Epoch: 1/1
2025-05-06 03:13:42 INFO     Train Epoch: 1 [0/79] Loss: 1.2453 Accuracy: 64.84%
2025-05-06 03:13:42 INFO     计算Batch 5的Hessian特征值和特征向量
2025-05-06 03:13:42 INFO     保存模型到: ./hessian_analysis_test/models/model_batch_5.pth
2025-05-06 03:13:59 INFO     Batch 5的Top-10特征值: [4350.43359375, 2092.787109375, 1869.427978515625, 1294.209228515625, 911.2433471679688, 828.7800903320312, 776.6233520507812, 670.3106079101562, 632.2897338867188, 542.6263427734375]
2025-05-06 03:13:59 INFO     Batch 5的Trace: 23685.613509114584
2025-05-06 03:13:59 INFO     保存特征值和特征向量到: ./hessian_analysis_test/eigen_vectors/eigen_batch_5.npz
2025-05-06 03:13:59 INFO     计算Batch 10的Hessian特征值和特征向量
2025-05-06 03:13:59 INFO     保存模型到: ./hessian_analysis_test/models/model_batch_10.pth
2025-05-06 03:14:17 INFO     Batch 10的Top-10特征值: [1180.9083251953125, 1096.5064697265625, 762.8787841796875, 625.5211181640625, 468.0339050292969, 440.6550598144531, 366.03631591796875, 347.5303649902344, 250.2378692626953, 229.26565551757812]
2025-05-06 03:14:17 INFO     Batch 10的Trace: 9830.922209821429
2025-05-06 03:14:18 INFO     保存特征值和特征向量到: ./hessian_analysis_test/eigen_vectors/eigen_batch_10.npz
2025-05-06 03:14:18 INFO     Train Epoch: 1 [10/79] Loss: 1.8898 Accuracy: 46.09%
2025-05-06 03:14:18 INFO     计算Batch 15的Hessian特征值和特征向量
2025-05-06 03:14:18 INFO     保存模型到: ./hessian_analysis_test/models/model_batch_15.pth
2025-05-06 03:14:31 INFO     Batch 15的Top-10特征值: [936.8204956054688, 707.3605346679688, 468.368408203125, 388.8059387207031, 270.8253479003906, 267.80706787109375, 207.47848510742188, 145.33529663085938, 164.60780334472656, 128.59666442871094]
2025-05-06 03:14:31 INFO     Batch 15的Trace: 7133.323112936581
2025-05-06 03:14:31 INFO     保存特征值和特征向量到: ./hessian_analysis_test/eigen_vectors/eigen_batch_15.npz
2025-05-06 03:14:32 INFO     计算Batch 20的Hessian特征值和特征向量
2025-05-06 03:14:32 INFO     保存模型到: ./hessian_analysis_test/models/model_batch_20.pth
2025-05-06 03:14:54 INFO     Batch 20的Top-10特征值: [889.0255737304688, 793.0250854492188, 585.6594848632812, 403.5805969238281, 273.7139892578125, 210.99502563476562, 201.6812286376953, 169.6905059814453, 147.48936462402344, 131.69039916992188]
2025-05-06 03:14:54 INFO     Batch 20的Trace: 7920.787885616987
2025-05-06 03:14:54 INFO     保存特征值和特征向量到: ./hessian_analysis_test/eigen_vectors/eigen_batch_20.npz
2025-05-06 03:14:54 INFO     Train Epoch: 1 [20/79] Loss: 1.3052 Accuracy: 56.25%
2025-05-06 03:14:54 INFO     计算Batch 25的Hessian特征值和特征向量
2025-05-06 03:14:54 INFO     保存模型到: ./hessian_analysis_test/models/model_batch_25.pth
2025-05-06 03:15:10 INFO     Batch 25的Top-10特征值: [983.5971069335938, 643.64501953125, 416.3726501464844, 345.00506591796875, 249.17367553710938, 177.74049377441406, 190.95269775390625, 167.44813537597656, 146.05503845214844, 138.35972595214844]
2025-05-06 03:15:10 INFO     Batch 25的Trace: 7198.868610250539
2025-05-06 03:15:10 INFO     保存特征值和特征向量到: ./hessian_analysis_test/eigen_vectors/eigen_batch_25.npz
2025-05-06 03:15:10 INFO     计算Batch 30的Hessian特征值和特征向量
2025-05-06 03:15:10 INFO     保存模型到: ./hessian_analysis_test/models/model_batch_30.pth
2025-05-06 03:15:28 INFO     Batch 30的Top-10特征值: [567.6382446289062, 448.392578125, 334.7884826660156, 318.3828125, 266.2685852050781, 180.21237182617188, 147.7915496826172, 127.98158264160156, 120.16561126708984, 112.46442413330078]
2025-05-06 03:15:28 INFO     Batch 30的Trace: 5905.571759905134
2025-05-06 03:15:28 INFO     保存特征值和特征向量到: ./hessian_analysis_test/eigen_vectors/eigen_batch_30.npz
2025-05-06 03:15:28 INFO     Train Epoch: 1 [30/79] Loss: 0.6331 Accuracy: 82.81%
2025-05-06 03:15:29 INFO     计算Batch 35的Hessian特征值和特征向量
2025-05-06 03:15:29 INFO     保存模型到: ./hessian_analysis_test/models/model_batch_35.pth
2025-05-06 03:15:44 INFO     Batch 35的Top-10特征值: [652.0529174804688, 521.576171875, 376.7699890136719, 314.4615783691406, 257.0777587890625, 216.0344696044922, 143.57350158691406, 137.2959442138672, 114.1741943359375, 127.24058532714844]
2025-05-06 03:15:44 INFO     Batch 35的Trace: 6122.306919642857
2025-05-06 03:15:44 INFO     保存特征值和特征向量到: ./hessian_analysis_test/eigen_vectors/eigen_batch_35.npz
2025-05-06 03:15:44 INFO     计算Batch 40的Hessian特征值和特征向量
2025-05-06 03:15:44 INFO     保存模型到: ./hessian_analysis_test/models/model_batch_40.pth
2025-05-06 03:16:06 INFO     Batch 40的Top-10特征值: [584.4611206054688, 479.87738037109375, 332.9944152832031, 274.8096008300781, 231.48666381835938, 212.65396118164062, 181.3806610107422, 154.01295471191406, 118.36436462402344, 111.39130401611328]
2025-05-06 03:16:06 INFO     Batch 40的Trace: 6564.759033203125
2025-05-06 03:16:06 INFO     保存特征值和特征向量到: ./hessian_analysis_test/eigen_vectors/eigen_batch_40.npz
2025-05-06 03:16:06 INFO     Train Epoch: 1 [40/79] Loss: 0.7597 Accuracy: 75.78%
2025-05-06 03:16:06 INFO     计算Batch 45的Hessian特征值和特征向量
2025-05-06 03:16:06 INFO     保存模型到: ./hessian_analysis_test/models/model_batch_45.pth
2025-05-06 03:16:23 INFO     Batch 45的Top-10特征值: [641.6806030273438, 450.3243408203125, 317.98944091796875, 290.7624206542969, 241.03074645996094, 181.02857971191406, 165.10916137695312, 143.76467895507812, 129.8915557861328, 121.62344360351562]
2025-05-06 03:16:23 INFO     Batch 45的Trace: 5623.506103515625
2025-05-06 03:16:23 INFO     保存特征值和特征向量到: ./hessian_analysis_test/eigen_vectors/eigen_batch_45.npz
2025-05-06 03:16:23 INFO     计算Batch 50的Hessian特征值和特征向量
2025-05-06 03:16:23 INFO     保存模型到: ./hessian_analysis_test/models/model_batch_50.pth
2025-05-06 03:16:41 INFO     Batch 50的Top-10特征值: [531.3145751953125, 490.0897521972656, 314.292236328125, 253.36300659179688, 284.2899475097656, 232.48252868652344, 171.18482971191406, 149.67515563964844, 125.59644317626953, 115.10501098632812]
2025-05-06 03:16:41 INFO     Batch 50的Trace: 6208.653144836426
2025-05-06 03:16:41 INFO     保存特征值和特征向量到: ./hessian_analysis_test/eigen_vectors/eigen_batch_50.npz
2025-05-06 03:16:41 INFO     Train Epoch: 1 [50/79] Loss: 0.7307 Accuracy: 76.56%
2025-05-06 03:16:41 INFO     计算Batch 55的Hessian特征值和特征向量
2025-05-06 03:16:41 INFO     保存模型到: ./hessian_analysis_test/models/model_batch_55.pth
2025-05-06 03:16:56 INFO     Batch 55的Top-10特征值: [727.6983032226562, 408.2154235839844, 358.5221252441406, 356.504150390625, 245.91598510742188, 179.3144073486328, 195.64764404296875, 165.63819885253906, 154.19728088378906, 120.38400268554688]
2025-05-06 03:16:56 INFO     Batch 55的Trace: 6270.672932942708
2025-05-06 03:16:56 INFO     保存特征值和特征向量到: ./hessian_analysis_test/eigen_vectors/eigen_batch_55.npz
2025-05-06 03:16:56 INFO     计算Batch 60的Hessian特征值和特征向量
2025-05-06 03:16:56 INFO     保存模型到: ./hessian_analysis_test/models/model_batch_60.pth
2025-05-06 03:17:12 INFO     Batch 60的Top-10特征值: [728.0733032226562, 458.4543762207031, 342.5491027832031, 316.7539367675781, 246.0135498046875, 228.5205535888672, 187.3750457763672, 161.1053466796875, 145.81837463378906, 118.88858795166016]
2025-05-06 03:17:12 INFO     Batch 60的Trace: 5780.695385742188
2025-05-06 03:17:12 INFO     保存特征值和特征向量到: ./hessian_analysis_test/eigen_vectors/eigen_batch_60.npz
2025-05-06 03:17:12 INFO     Train Epoch: 1 [60/79] Loss: 0.6267 Accuracy: 81.25%
2025-05-06 03:17:12 INFO     计算Batch 65的Hessian特征值和特征向量
2025-05-06 03:17:12 INFO     保存模型到: ./hessian_analysis_test/models/model_batch_65.pth
2025-05-06 03:17:26 INFO     Batch 65的Top-10特征值: [604.8848266601562, 544.6841430664062, 378.43353271484375, 322.21624755859375, 250.6679229736328, 190.57464599609375, 180.43975830078125, 151.62521362304688, 162.8121795654297, 125.84298706054688]
2025-05-06 03:17:26 INFO     Batch 65的Trace: 6031.312115293561
2025-05-06 03:17:26 INFO     保存特征值和特征向量到: ./hessian_analysis_test/eigen_vectors/eigen_batch_65.npz
2025-05-06 03:17:26 INFO     计算Batch 70的Hessian特征值和特征向量
2025-05-06 03:17:26 INFO     保存模型到: ./hessian_analysis_test/models/model_batch_70.pth
2025-05-06 03:17:40 INFO     Batch 70的Top-10特征值: [608.6072387695312, 418.00115966796875, 310.4644775390625, 295.032470703125, 250.55821228027344, 226.87344360351562, 159.9823455810547, 132.10308837890625, 128.36544799804688, 123.45532989501953]
2025-05-06 03:17:40 INFO     Batch 70的Trace: 5848.943080357143
2025-05-06 03:17:40 INFO     保存特征值和特征向量到: ./hessian_analysis_test/eigen_vectors/eigen_batch_70.npz
2025-05-06 03:17:40 INFO     Train Epoch: 1 [70/79] Loss: 0.7561 Accuracy: 73.44%
2025-05-06 03:17:40 INFO     计算Batch 75的Hessian特征值和特征向量
2025-05-06 03:17:40 INFO     保存模型到: ./hessian_analysis_test/models/model_batch_75.pth
2025-05-06 03:17:59 INFO     Batch 75的Top-10特征值: [625.2523193359375, 336.2109375, 289.7562561035156, 275.538330078125, 191.61392211914062, 136.2451171875, 122.51032257080078, 104.26560974121094, 95.58438110351562, 88.34107208251953]
2025-05-06 03:17:59 INFO     Batch 75的Trace: 4931.223398636798
2025-05-06 03:17:59 INFO     保存特征值和特征向量到: ./hessian_analysis_test/eigen_vectors/eigen_batch_75.npz
2025-05-06 03:17:59 INFO     在微调后计算Hessian特征值和特征向量
2025-05-06 03:18:15 INFO     微调后的Top-10特征值: [517.6236572265625, 303.70416259765625, 311.98431396484375, 250.91574096679688, 200.0325927734375, 166.81089782714844, 138.5498046875, 117.22758483886719, 88.4470443725586, 92.35479736328125]
2025-05-06 03:18:15 INFO     微调后的Trace: 4824.186979874321
2025-05-06 03:18:15 INFO     保存最终模型到: ./hessian_analysis_test/models/model_final.pth
2025-05-06 03:18:15 INFO     对收集的特征向量进行PCA分析
2025-05-06 03:18:19 INFO     特征向量矩阵形状: (170, 272474)
2025-05-06 03:18:22 INFO     PCA解释方差比例: [0.08284412 0.08029718 0.07626212 0.07268171 0.06771609 0.06527676
 0.0602416  0.05288025 0.04381491 0.03437395 0.03126361 0.02329011
 0.02072468 0.01538019 0.01297329 0.01043481 0.00957425 0.00935283
 0.00845867 0.00729723]
2025-05-06 03:18:22 INFO     累积解释方差: [0.08284412 0.16314129 0.23940342 0.31208513 0.37980122 0.44507798
 0.50531958 0.55819983 0.60201474 0.63638868 0.66765229 0.69094241
 0.71166709 0.72704728 0.74002057 0.75045539 0.76002964 0.76938247
 0.77784114 0.78513837]
2025-05-06 03:18:24 INFO     总运行时间: 308.64 秒
2025-05-06 03:18:24 INFO     实验完成！
